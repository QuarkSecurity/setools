<html>
<head>
<title>SELinux Policy Analysis Tool Help File</title>
</head>

<body>

<h1>Overview</h1>

<p>
This file contains basic help information for using apol, a graphical
policy analysis tool for Security Enhanced (SELinux) policies.  The
tool provides the ability to:
</p>

<ul>
<li>Examine, search, and relate policy components (types, type
    attributes, object classes, object permissions, roles, users,
    initials SIDs, MLS components, network and file system contexts,
    and booleans), and policy rules (allow, neverallow, auditallow,
    dontaudit, type_transition, type_change, role allow,
    role_transition, and range_transition).</li>

<li>Create and query an on-disk database that contains SELinux
    context information about the filesystem.</li>

<li>Perform some automated analysis of policies, including forward and
    reverse domain transition analyses, direct information flow
    analysis, as well as transitive (indirect) information flow
    analysis, direct relabel analysis, and type relationship analysis.</li>
</ul>

<p>
The tool supports source, monolithic binary, and modular binary
policies.  Certain apol features may be disabled if the underlying
policy does not support the action.  For example, rule searches will
not report line numbers when searching monolithic binary polices.
</p>

<p>
Apol provides compatibility with the current and previous policy
syntax.  It supports analysis of monolithic policy versions 12 to the
current version 21 and modular policy versions 5 and 6.
</p>


<h1>Menus</h1>

<p>
Use <tt>Open</tt> from the <tt>File</tt> menu to open a valid policy.
The policy may be monolithic or be composed of a base linked with
multiple modules.  Only one policy can be open at a time; opening a
second policy will result in the first being closed.
</p>

<p>
<a name="query_menu">The</a> <tt>Query</tt> menu allows the user to
save or load a query for a <tt>TE Rules</tt> search or for an analysis
module listed on the <tt>Analysis</tt> tab.  Saving a query writes the
appropriate parameters and settings to a <tt>.qf</tt> file:  for TE
Rules queries, the required query parameters are saved; for analysis
queries, the required query parameters as well as the specified
advanced settings are saved.  When loading a query, apol parses the
specified query (<tt>.qf</tt>) file, raises the correct tab and
configures the query options with the specified query parameters and
advanced settings.  The <tt>Load Query</tt> menu item is enabled
across all tabs, but the <tt>Save Query</tt> menu item is only enabled
when the Analysis tab or the TE Rules tab (see the <a
href="#policy_rules">Policy Rules tab description</a> below) is
raised.  Choose <tt>Policy Summary</tt> from the <tt>Query</tt> menu
to display statistics about the currently loaded policy.  A shorthand
version of these statistics is always displayed on the status bar when
a policy is opened.
</p>

<p>
Permission mappings are managed through the <tt>Tools</tt> menu.  The
mappings are used by apol's direct and transitive information flow
analyses.  Mappings may be viewed with the <tt>View Perm Map</tt> menu
item.  Although the ensuing dialog is not required to perform an
information flow analysis, the user may fine tune those mappings.  See
the separate <a href="infoflow_help.html">help file on information
flow</a> for more information about permission mappings and their
management.
</p>


<h1>Policy Components tabs</h1>

<p>
The <tt>Policy Components</tt> tabs provide the means to examine,
search, and relate the core components of an SELinux policy.
</p>


<h2>Types tab</h2>

<p>
  Use the <tt>Types</tt> tab to search through types and attributes.
  Double click or right click on any type or attribute in the list
  boxes to see full details for that type or attribute.  If a file
  index has been loaded (see <a href="#file_contexts">File Contexts
  tab description</a> below), details will include files labeled with
  that particular type or attribute.
</p>

<p>
  Use the search options and hit the <tt>OK</tt> button to perform
  searches for types.  Alternately, use the <tt>Search using regular
  expression</tt> box to search for types and/or attributes using a
  POSIX-style regular expression.
</p>

<h2>Classes/Perms tab</h2>

<p>
  Use the <tt>Classes/Perms</tt> tab to view and search object
  classes, common permissions, and permissions defined in a policy.
  Double clicking on any name from the three list boxes gives a brief
  summary of the class, permission, or common permission. Use the
  search options to view more detailed aspects of classes and
  permissions.
</p>

<p>
  For example, to display the objects that use the permission
  <sample>getattr</sample>, select <tt>Permissions</tt>, and the
  button <tt>Object Classes</tt> directly below it.  Then select
  <tt>Search using regular expression</tt> and type
  <kbd>^getattr$</kbd> in the box.  Press <tt>OK</tt> and a list of
  object classes that use that permission displays.  A
  <sample>*</sample> will mean that the class uses that permission via
  a common permission.
</p>

<p>
  Regular expressions can be used to constrain the search.  For
  example, to find all the permissions that start with the string
  <sample>set</sample>, use the regular expression <kbd>^set</kbd>.
</p>

<h2>Roles tab</h2>

<p>
  Use the <tt>Roles</tt> tab to search roles and their allowed types.
  Functionality for this tab is essentially the same as the
  <tt>Types</tt> tab (e.g., double click on a role for details about
  that role).
</p>

<p>
  The primary search option provides the means to find all roles that
  include a given type.
</p>

<h2>Users tab</h2>

<p>
  Select the <tt>Users</tt> tab to search users defined in the policy
  and to view the roles allowed for that user, the default MLS level
  and allowed MLS range for users (if a MLS policy is loaded).
</p>

<h2>Booleans tab</h2>

<p>
  Select the <tt>Booleans</tt> tab to search the boolean variables
  defined in the policy, as well as to view the current state and/or
  policy default state of the variable.  This tab also provides the
  interface to change the state of the boolean variable to
  <code>TRUE</code> or <code>FALSE</code>.  This boolean state change
  will be applied in memory and but will not change the state within
  the actual policy.
</p>

<h2>MLS tab</h2>

<p>
  Select the <tt>MLS</tt> tab to search sensitivities and categories
  in the policy, as well as to display the level statements for
  sensitivities and which sensitivites can be associated with a
  category.
</p>

<h2>Initial SIDS tab</h2>

<p>
  Select the <tt>Initial SIDS</tt> tab to search initial sids defined
  in the policy, as well as to view the context for each initial sid.
</p>

<h2>Net Contexts tab</h2>

<p>
  Select the <tt>Net Contexts</tt> tab to search network-based
  contexts (<code>portcon</code>, <code>netifcon</code>, and
  <code>nodecon</code> statements) defined in the policy.
</p>

<h2>FS Contexts tab</h2>

<p>
  Select the <tt>FS Contexts</tt> tab to search filesystem-based
  contexts (<code>fs_use_</code> and <code>genfscon</code> statements)
  defined in the policy.
</p>

<a name="policy_rules"><h1>Policy Rules tabs</h1></a>

The <tt>Policy Rules</tt> tabs allow more advanced analysis of an
SELinux policy.  They provide the means to search and select from the
many rules in a policy based on selected search criteria.

<h2>TE Rules tab</h2>

<p>
  Select the <tt>TE Rules</tt> tab to search through type enforcement
  rules.  This is the most extensively used tab, as well as the most
  complicated.
</p>

<p>
  Three different types of search criteria exist for TE Rules:
<p>

<ol>
   <li>
       <p>
       <tt>RULE SELECTION</tt>: provides options to limit the scope of
       search; only those rules selected will be included in the
       search.  At least one must be selected.  NOTE: If no additional
       search criteria is specified, apol will search for all of the
       selected rules.
       </p>
   </li>

   <li>
       <p>
       <tt>TYPE/ATTRIBUTES SUBTAB</tt>: provides options to refine a
       search based on types and/or type attributes used by a rule.
       There are three general type search options: source, target,
       and default.  Default is useful only if one or more of type
       transition/member/change rules are selected; other rules do not
       use the default field.  The source field also can be used as an
       <tt>any</tt> field.  In this case, the other two options will
       not be available, and the search will look for the selected
       type/attribute in any field of the selected rules.
       </p>
       
       <p>
       Use drop down boxes to select a type or attribute. If the
       <tt>Search using regular expression</tt> box is checked, enter
       a regular expression in any type/attrib box.  If regular
       expressions are disabled, apol currently supports only one
       type/attribute in each box.  This type/attrib must be a
       complete, valid type or attribute string.  The <tt>Default</tt>
       field can only be a type, not an attribute.
       </p>

       <p>
       If the <tt>Search only enabled rules</tt> checkbox is selected,
       query results will include all rules that meet the search
       criteria, <strong>excluding</strong> any rules that have been
       disbled by a conditional expression.  If the checkbox is not
       selected, query results will include all rules that meet the
       search criteria, <strong>including</strong> those rules that
       have been disabled by a conditional expression.
       </p>

       <p>
       Typically a search for a particular type also returns rules
       that employ some of that type's attributes.  Likewise, a search
       for an attribute returns rules that use some of that
       attribute's types.  This <em>indirect</em> searching is enabled
       by default.  The <tt>Only direct matches</tt> checkbox alters
       the meaning of the search field such that it performs literal
       searches upon the identifier.
       </p>
    </li>

    <li>
       <p>
       <tt>CLASSES/PERMISSIONS SUBTAB</tt>: provides options to refine
       a search using object classes and/or permissions.  Only rules
       that contain the selected object classes and selected
       permissions will be returned.  Each of these boxes allow
       multiple selections.  In the case of multiple select, apol
       treats them using an <em>or</em> semantic (e.g., if two object
       classes, such as <sample>dir</sample> and
       <sample>file</sample>, are selected, rules that apply to file
       <stronge>or</strong> directory object classes are selected).
       </p>

       <p>
       This tab also includes a section for <tt>AV Rule
       Permissions</tt> as a means to prune the list of permissions
       based on the object classes selected.  However, if none of the
       AV rules have been selected the permissions section will be
       disabled.  If <tt>All for selected classes</tt> is selected,
       only permissions related to selected objects are shown.  The
       <tt>Common to selected classes</tt> option instead only shows
       permissions that all selected classes have.  Below is a
       checkbox that changes permission matching behavior.  If more
       than one permission is selected, the default behavior is to
       return rules that contain any of those selections.  When the
       checkbox is enabled, returned rules instead will contain all of
       them.
       </p>
    </li>
</ol>

<p>
  In the <tt>Results</tt> section for a given search, all rules that meet
  the search criteria are displayed.  In addition, if the policy that
  is opened is capable of showing line numbers, a hyperlink for each
  rule is shown.  Clicking on this link will raise the <tt>Policy
  Source</tt> tab and highlight the exact line in the source file
  where the rule was found.  This traces the rule back to the ultimate
  source code.  If the policy cannot show line numbers then there will
  be no hyperlinks.
</p>

<p>
  The <tt>TE Rules</tt> tab also supports multiple results displayes.
  Each active window remembers the search options used for it, and
  will set all the options accordingly when selected.  Use the
  <tt>Update Search</tt> button to change the results displayed for
  the current window based on the current search option.  <tt>New
  Search</tt> creates a new results window based on the current search
  options.  Use the <tt>Close Tab</tt> bar at the bottom to destroy a
  results window.  Also, the <tt>TE Rules</tt> tab provides the means
  to save and load search criteria to a file (see <a
  href="#query_menu">Menus section</a> above).
</p>

<h2>Conditional Expressions tab</h2>

<p>
  Select the <tt>Conditional Expressions</tt> tab to search
  conditional expressions within the policy, as well as to view the
  rules within these conditional expressions.  Note that conditional
  expressions are displayed in Reverse Polish Notation.
</p>

<p>
  By default, all conditionals are displayed; however they can be
  limited to expressions that use particular boolean variables.  The
  current state of each rule is provided by means of a tag within the
  results:
</p>

<dl>
  <dt><tt>[Enabled]</tt></dt>
  <dd>indicates the rule is enabled</dd>

  <dt><tt>[Disabled]</tt></dt>
  <dd>indicates the rule is disabled</dd>
</dl>

<h2>RBAC Rules tab</h2>

<p>
  Select the <tt>RBAC Rules</tt> tab to search role-based access
  control rules.  Much like the <tt>TE Rules tab</tt>, enter a source,
  target, and default to find rules that match the query.  The search
  options box changes based upon the type of rule being searched, role
  <code>allow</code>, <code>role_transition</code>, or both.
</p>

<p>
  As with <tt>TE Rules</tt>, the <tt>Source</tt> role can also be used
  in an <tt>any</tt> search.
</p>

<h2>Range Transition Rules tab</h2>

<p>
  Select the <tt>Range Transition Rules</tt> tab to search
  <code>range_transition</code> rules by source and target types and
  by the MLS range.  There are three options when searching for
  ranges: find exact matches to the entered range, find rules that
  have ranges that contain the entered range, or find rules that have
  ranges within the entered range.
</p>

<a name="file_contexts"><h1>File Contexts tab</h1></a>

<p>
The <tt>File Contexts</tt> tab provides the following features:
</p>

<h2>Creating/Loading an Index File</h2>

<p>
  An index file is an on-disk database that contains SELinux context
  information about the filesystem, including SELinux users and types
  associated with file paths and object classes.  The user may create
  a new index file or load an existing one by clicking the appropriate
  button.  Select the <tt>Load</tt> button to display a file selection
  dialog.  Choose <tt>Create and Load</tt> button to specify the save
  file and the directory from which to start the indexing.  Upon
  clicking <tt>OK</tt>, an index file will be created and then loaded
  into apol.
</p>

<h2>Searching an Index File</h2>

<p>
  Specify the user, role, type, MLS range, object class, or path, then
  click <tt>OK</tt> to perform the query.  Regular expressions can be
  specified for all fields except the <tt>Object class</tt> field.
  Once the search is finished, apol displays a list of files that
  matched the criteria, along with those files' context and/or object
  type, if specified.
</p>

<h1>Analysis tab</h1>

<p>
The <tt>Analysis,/tt> tab provides automated analysis capabilities.
The <tt>Info</tt> button provides a description for the selected
analysis type.  Also, this tab supports saving/loading any query
criteria to a file (see <a href="#query_menu">Menus section</a>
above).
</p>

<h2>Direct Information Flow Analysis</h2>

<p>
  The <tt>Direct Information Flow</tt> analysis takes a starting type
  and an information flow direction (<tt>In</tt>, <tt>Out</tt>,
  <tt>Either</tt>, or <tt>Both</tt>), and presents a tree with the
  starting type as the root node.  The child nodes represent other
  types in the policy where information flow can occur
  <strong>directly</strong> between its parent node and itself.  If
  the flow direction is <tt>In</tt>, information in the child node
  types can flow to the parent node type.  If the flow direction is
  <tt>Out</tt>, information in the parent node can
  <strong>directly</strong> flow to the child node.  If the direction
  is <tt>Both</tt>, information flow is bidirectional, from child to
  parent and also from parent to child.  If <tt>Either</tt> is
  selected, flow direction will be in any direction.
</p>

<p>
  Select a child node to show all the rules that permit the
  information flow to occur.  Results are sorted by object class.
</p>

<p>
  Results can be filtered by selecting one or more object classes.
  This will ensure that only those flows that are allowed for the
  selected object class will be shown (e.g., selecting
  <sample>file</sample> will prevent flows allowed for
  <sample>sockets</sample> from being presented).  Use a regular
  expression to limit the results by end type.  Only those end types
  that match the provided regular expression will be presented.
</pp>

<p>
  See the separate <a href="infoflow_help.html">help file on
  information flow</a> for more information about direct information
  flow.
<p>

<h2>Direct Relabel Analysis</h2>

<p>
  See the separate help file on direct file relabel analysis, which can
  be accessed from the help menu in apol.
</p>

<h2>Domain Transition Analysis</h2>

<p>
  Use the <tt>Domain Transition</tt> analysis module to specify a
  transition direction for the analysis.  The two directions provided
  are:
</p>

      FORWARD: The Forward Domain Transition (FDT) analysis takes a
	       starting SOURCE domain and presents a tree of all the
	       resulting TARGET domains that can be transitioned into
	       from that starting domain.  The tree can be walked to
	       follow the FDT tree to any depth.  The only restriction
	       is that a subtree will not expand if its parent is the
	       same as the node. Each node in the FDT tree represents
	       a TARGET domain to which the parent domain can directly
	       transition.

               The Forward Domain Transition (FDT) analysis also
	       provides the means to limit the query to find
	       transitions only to domains that are granted specific
	       object class permissions and/or are granted access to a
	       particular object type(s).  Use the 'Access Filters'
	       dialog to select object types object classes, and
	       permissions in order to limit the query to this
	       constrained analysis.  By default, all object types,
	       object classes and permissions are included in the
	       query.  Selecting an object class from the listbox
	       widget will display all permissions for that object
	       class.

               A specific example where this advanced feature would be
               useful is when one is seeking to find transitions from
               'user_t' to domains with write access to files in the
               'shadow_t' domain. In this case:

                 - Specify 'user_t' as the source domain.
                 - Using the Access Filters dialog, select the
		   'shadow_t' object type, 'file' object class, and
		   'write' permission.

      REVERSE: As its name implies, the Reverse Domain Transition
               (RDT) analysis is the reverse of the FDT analysis. The
               RDT takes a starting TARGET domain and presents a tree
               of all the resulting SOURCE domains that can directly
               transition to that TARGET domain.  The tree can be
               walked to follow the RDT tree to any depth.  The only
               restriction is that a subtree will not expand if its
               parent is the same as the node.  Each node in the RDT
               tree represents a SOURCE domain that can transition to
               its parent node.  This analysis does not provide the
               meands to constrain the query using the 'Access
               Filters' dialog, as is possible in Forward Domain
               Transition analysis.

  Selecting a child node will show all the rules that permit the
  transition to occur.  In the case of a Forward Domain Transition
  analysis, access granted to this target domain will also be appended
  to the results.

  See the separate help file for an overview of the criteria that
  constitute a valid domain transition.

  Transitive Information Flow Analysis

  Whereas the Direct Information Flow analysis identifies information flows that are
  directly allowed by one or more explicit rule, the Transitive
  Information Flow analysis attempts a much more extensive
  analysis.  Specifically, transitive flow identifies indirect paths between
  two types.  Since such paths can be circuitous or over many hops,
  this analysis is quite difficult to achieve.

  Transitive flow takes a starting type and an information flow direction (To or
  From) and presents a tree with the starting type as the root node.
  The child nodes represent other types in the policy where
  information flow can occur (directly or transitively) between the
  parent node and itself.  If the flow direction is To, the
  information flow is to the parent node.  If the flow direction is
  From, the information flow is to the child node.

  Selecting a child node shows each step in the flow chain between the
  starting node and the child node, along with the rules that allow
  that step to occur.  Additionally, embedded in the text of the
  results is a hyperlink for finding more flows between the starting
  node and the selected child node.  This link displays a dialog to
  specify a time limit for the search and/or limit the number of flows
  to find in the search.

  As with the direct flow analysis, results can be filtered using end type
  regular expression.

  Additionally, the transitive flow analysis provides the Advanced Filters dialog
  for filtering results by object class permissions and/or types.
  Selecting an object class in the Advanced Filters dialog will
  display a list of permissions for that object class, whereby certain
  permissions can be included or excluded.  By default, all
  permissions for an object class are included in the query, unless a
  permission's 'Exclude' radiobutton is selected.  Configuring all
  permissions for an object class to be excluded will exclude the
  object class itself from the query. When an object class becomes
  excluded, its label will change to indicate that the object class is
  to be excluded from the analysis query.

  Additionally, the Advanced Filters dialog displays the weight value
  of a permission, as specified in the loaded permission map.  See the
  separate help file on information flow for more information about
  managing permission mappings.  Specify a weight threshold in order
  to exclude permissions from the results that have weights below a
  certain threshold.  Query results can also be filtered by including
  or excluding intermediate types.

  See the separate help file on information flow for more information
  about transitive information flow.

  Types Relationship Summary Analysis
  -----------------------------------
  See the separate help file on types relationship summary analysis,
  which can be accessed from the help menu in apol.


<h1>Policy Source tab</h1>

<p>
The <tt>Policy Source</tt> tab provides a convenient display of the
raw policy source file.  If a modular policy was loaded, this tab
shows only the base policy's source.  Various search results will
hyperlink to lines within this tab.  If the loaded policy is not
source then this tab will be disabled.
</p>

</body>
</html>
