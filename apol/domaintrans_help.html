<html>
<head>
<title>Domain Transition Analysis</title>
</head>

<body>

<h1>An overview of domain transition analysis</h1>

<p>
A key feature of Type Enforcement security is the ability to define
domain types with which programs run, to use that domain type to
control access to objects (which are also typed), and strictly control
the ability of a process to change its domain type.  This last ability
is known as domain transition.
</p>

<p>
Apol supports analysis of an SELinux policy to understand the domain
transitions it allows.  As with all access in SELinux, the ability to
transition from one domain to another is controlled by
<code>allow</code> rules in the policy.  Below, we describe how apol
performs a domain transition analysis.
</p>

<h1>The three types of interest for domain transitions</h1>

<p>
When discussing domain transition access, there are three different
types we must consider:
</p>

<ul>

<li><em>Source Type</em>: This is the domain type associated with a
    process that is trying to change (transition) its domain type to
    another type.</li>

<li><em>Target Type</em>: This is the domain type to which the source
    type is trying to transition.</li>

<li><em>File Type (Entrypoint Type)</em>: This is a type associated
    with an executable file object that allows the target type to be
    entered as part of an <code>execve()</code> system call.</li>

</ul>

<h1>Forward vs. reverse domain transition analysis</h1>

<p>
Apol supports both forward and reverse domain transition analysis.  A
forward analysis determines all the <em>target types</em> to which the
selected <em>source types</em> may transition.  The results may be
further filtered by selecting particular object classes, permissions,
and object types to find transitions to domains that have those
specific privileges or that have access to a particular object
type(s).  A reverse analysis is the opposite; select a <em>target
type</em> and determine all the <em>source types</em> that may
transition to the target type.
</p>

<p>
In each case, apol creates a tree structure to show the result.  Drill
down the tree to follow any given transition path.
</p>

<h1>Criteria for identifying allow domain transitions</h1>

<p>
In SELinux, three types of access (and hence at least three rules)
must be allowed by the policy for a domain transition to occur.  These
three access types form the criterion used by apol to determine allowed
transitions.
</p>

<p>
Given an understanding of the three types of interest in a domain
transition, the criteria for an allowed domain transition are as
follows.  In the examples below, assume <sample>user_t</sample> is the
source type, <sample>passwd_t</sample> is the target type, and
<sample>passwd_exec_t</sample> is the file entry point type.
</p>

<ol>

<li>
<p>A rule must exist that allows the source domain type
   <code>transition</code> access for <code>process</code> object
   class for the TARGET domain type. For example, the rule:
</p>

<blockquote>
   <sample>allow user_t passwd_t : process transition;</sample>
</blockquote>

<p>meets this criterion by allowing the source type (<tt>user_t</tt>)
   <tt>process transition</tt> permission to the target type
   (<tt>passwd_t</tt>).</li>
</p>
</li>

<li>
<p>A rule must exist that allows the source domain type
   <code>execute</code> access to the file entrypoint type.  For
   example, the rule:
</p>

<blockquote>
   <sample>allow user_t passwd_exec_t : file {read getattr execute};</sample>
</blockquote>

<p>meets the criterion by allowing the source type (<tt>user_t</tt>)
   <tt>execute</tt> access to the file entrypoint type
   (<tt>passwd_exec_t</tt>).
</p>
</li>

<li>
<p>A rule must exist that allows the target domain type
   <code>entrypoint</code> access to the file entrypoint type for file
   objects.  For example, the rule:
</p>

<blockquote>
   <sample>allow passwd_t passwd_exec_t : file entrypoint;</sample>
</blockquote>

<p>meets this criterion by allowing the target type
    (<tt>passwd_t</tt>) <tt>file entrypoint</tt> access to the file
    entrypoint type (<tt>passwd_exec_t</tt>).
</p>
</li>

<li>
<p>There must be a way for the transition to be specified.  Typically
   this is accomplished in the policy with a
   <code>type_transition</code> statement.  For example, the
   statement:
</p>

<blockquote>
  <sample>type_transition user_t password_exec_t : process
  passwd_t;</sample>
</blockquote>

<p>meets this criterion by specifying that when <tt>user_t</tt>
   executes a program with the <tt>passwd_exec_t</tt> type, the
   default type of the new process is <tt>passwd_t</tt>.  This is the
   most common specifier because it does not require the programs to
   be SELinux-aware.  Alternatively, the program can be made
   SELinux-aware and the program itself may specify the type of the
   new process.  For example, the statement:
</p>

<blockquote>
   <sample>allow user_t self : process setexec;</sample>
</blockquote>

<p>allows the source type (<tt>user_t</tt>) to specify the type of new
   processes when executing programs.  In both the
   <code>type_transition</code> and <code>setexec</code> cases, the
   types that the source domain may transition to are limited by the
   previous three criterion.
</p>
</li>

</ol>

<p>
In the analysis results for a reverse domain transition analysis, apol
will list all the types that meet the above four criteria.  On the
other hand, results for a forward domain transition analysis will be
limited to types that meet the above four criteria and that have the
specified privileges or access to a particular object type(s).  In
apol, see <tt>General Help</tt> for <a
href="apol_help.html#domain_transition">domain transition's Advanced
Search</a> options.
</p>


<h1>Filtering domain transition results in apol</h1>

<p>
The domain transition analysis interface in apol provides the ability
to further refine a domain transition query in order to find
transitions to a specific domain and/or transitions to domains that
are granted specific access to object types or classes.  Filtering
results types using regular expressions is enabled for both forward
and reverse domain transition queries; however, the access filters are
only enabled for a forward domain transition query.
</p>

<p>
To enable and use the access filters, select the <tt>Use access
filters</tt> checkbox and display the <tt>Access Filters</tt> dialog.
This dialog shows lists of included object types, object classes, and
permissions.  An access filter may be particulary useful to a user
searching for transitions to domains that have specific access to an
object type and/or class.  For example, one could determine whether
the type <sample>user_t</sample> is allowed to transition to a domain
that can write a file of type <sample>shadow_t</sample>.  To run this
query from apol, specify the starting type as <kbd>user_t</kbd>, go to
the Access Filters dialog, set <kbd>shadow_t</kbd> as the onlyincluded
object type, select <kbd>file</kbd> as the object classes, and then
select the <kbd>write</kbd> permission.  If multiple types, classes,
or permissions are selected, the results will include all transitions
to a domain with access to at least one of the selected types for at
least one of the selected classes with at least one of the selected
permissions.
</p>

</body>
</html>